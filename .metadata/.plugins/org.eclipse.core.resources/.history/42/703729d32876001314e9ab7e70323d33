var map;
var geocoder;

function mapInitialize() {
        var mapOptions = {
          center: new google.maps.LatLng(38.8951100	, -77.0363700),
          zoom: 3,
        };
        map = new google.maps.Map(document.getElementById("woodlawn_map"), mapOptions);
        geocoder = new google.maps.Geocoder();
        var location = new google.maps.LatLng(43.906732, -69.963793);
        var image = 'Images/W_pin.png';

        var marker = new google.maps.Marker({
            position: location,
            map: map,
            icon: image,
            title:"Hello World!"
        });
        
        google.maps.event.addListener(marker,'click',function() {
        	  map.setZoom(6);
        	  map.setCenter(marker.getPosition());
        	  });

        var infowindow = new google.maps.InfoWindow({
        	  content:"Sawyer Bowman!"
       	});

//        google.maps.event.addListener(marker, 'click', function() {
//        	  infowindow.open(map,marker);
//        });
        
        google.maps.event.addListener(marker, 'click', function() {
            showAlum();
        });
        
        var infobar = document.getElementById('infobar');
        map.controls[google.maps.ControlPosition.RIGHT_CENTER].push(infobar);
      }

function codeAddress() {
	  var address = document.getElementById('address').value;
	  geocoder.geocode( { 'address': address}, function(results, status) {
	    if (status == google.maps.GeocoderStatus.OK) {
	      map.setCenter(results[0].geometry.location);
	      var marker = new google.maps.Marker({
	          map: map,
	          position: results[0].geometry.location
	      });
	    } else {
	      alert('Geocode was not successful for the following reason: ' + status);
	    }
	  });
	}

function hideAlum() {
    document.getElementById("infobar").style.display="none";
}

function addListing(filt) {
	var ct =0;
	var ft = "";
	var v = "";
	if(filt.indexOf("any department") > -1) {
		filt = "";
	}


	if(qs_maj != "") {
		ft = "maj";
		qsi = parseInt(qs_maj);
		v = $("#selmaj option")[qsi].text;
		$('#selmaj').prop("selectedIndex",qsi);
		filt = ft+":"+v;
	}

	if(filt != "") {
		ff = filt.split(":");
		ft = ff[0];
		v = ff[1];


		//$('#fbox').toggle();
		hideStudent();

		if(ft=="maj") {
//			alert(v);
			$('#selcy').prop("selectedIndex",0);
		}
		if(ft=="cy") {
			$('#selmaj').prop("selectedIndex",0);
		}


	} else {
		$('#selcy').prop("selectedIndex",0);
		$('#selmaj').prop("selectedIndex",0);
	}

	$("#sl2").html("");
	clearOverlays();
	tim = new Date().getTime();
	$.ajax({
		type: "GET",
		url: "/interactive/summer-map/lib/summer.xml",
		dataType: "xml",
		cache: false}).done(function(data) {
			html = "";
			//loop through placemarks tags
			$(data).find("Placemark").each(function(index, value){
				ct++;
				var pers = "";
				var cy = "";
				var loc = "";
				var maj = "";


				//get coordinates and student name
				var coords = $(this).find("coordinates").text();
				var nm = $(this).find("name").text();
				$(this).find("Data").each(function()
						{
					if($(this).attr("name") == "classyear") {
						cy = $(this).find("value").text();
						//cy = cy.substring(2);
					}
					if($(this).attr("name") == "location") {
						loc = $(this).find("value").text();
					}   
					if($(this).attr("name") == "major") {
						maj = $(this).find("value").text();
					}

						});

				nm = nm
//				pid = "p"+nm.substring(0,nm.indexOf(" "))+coords.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"").substring(0,5);
//				pid = nm.replaceAll(" ","_");
				pid = "p"+nm.replace(/,-'()/g,"_");
				pid = pid.replace(/\s+/g,"_");		
				pid = pid+cy;

				//define person div
				var pers = "<div class=\"pers\" id=\""+pid+"\"><span class=\"mrkLnk\">" + nm +" '"+cy.substring(2)+"</span>";
				pers += "<div class='loc'>"+loc+"</div>";
				pers += "</div>";
				var c = coords.split(",")       


				//output as a navigation accounting in filters
				if(v == "" || (
						(ft='cy' && cy==v)
						|| (ft='maj' &&  maj.indexOf(v) > -1  && maj!=""    )) ) {

					$("#sl2").append(pers);


					var bpin = "lib/bpin.png";                
					var perLatlng = new google.maps.LatLng(c[1],c[0]);
					var marker = new google.maps.Marker({
						position: perLatlng,
						map: map,
						icon: bpin,
						title:nm
					});
					markersArray.push(marker);


					$("#"+pid).bind("click", function(){
						panToPoint = new google.maps.LatLng(c[1], c[0]);
						if(zkL == c[1]) {
							zk = zk +2;
						} else {
							zk =6;
							zkL = c[1];
						}

						map.panTo(panToPoint);
						map.setZoom(zk);
						google.maps.event.trigger(marker, 'click');
					});

					google.maps.event.addListener(marker, 'click', function() {
						showStudent(nm);
					});


				}

			});






//			alert(ct);            

		});


}


google.maps.event.addDomListener(window, 'load', mapInitialize);
      